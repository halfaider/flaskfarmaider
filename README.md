할 수 있는 것
---

- **새로고침**: Rclone의 리모트 서버에 vfs/refresh 요청
- **스캔**: Plex 서버에 Web API 스캔을 요청
- **Plexmate 스캔**: 로컬 파일의 경로명으로 Plexmate 플러그인에 스캔 요청
- **Plexmate Ready 새로고침**: Plexmate에서 파일 체크 대기중인 항목들을 vfs/refresh 요청
- **새로고침 후 스캔**: vfs/refresh 요청 후 Plex Web API 스캔 요청
- **새로고침 후 Plexmate 스캔**: vfs/refresh 요청 후 Plexmate 플러그인에 스캔 요청
- **새로고침 후 주기적 스캔**: vfs/refresh 요청 후 Plexmate 플러그인의 주기적 스캔 항목을 실행
- **시작 스크립트**: 시작시 한번 실행되어 Flaskfarm 실행에 필요한 쉘커맨드를 실행

필요한 것
---

- Plexmate 플러그인
- Rclone Remote Control 서버

설정하는 법
---
### Rclone Remote

- **Rclone Remote 주소**

    리모트 주소와 필요할 경우 User, Pass를 입력한 다음 접속 확인버튼을 클릭합니다.
    정상 접속될 경우 vfs/list 결과가 나타나고 리모트 항목에 자동으로 첫번째 vfs가 입력됩니다.

- **경로 변경 규칙(필수)**

    로컬 경로와 rclone 리모트의 경로가 다르기 때문에 변환이 필요합니다.
    콜론(:)으로 변경할 로컬 경로와 변경될 리모트 경로를 구분해 주세요.


    /변경할/로컬/경로:/변경될/리모트/경로


    예를 들어 아래와 같은 상황이라면...

    ```
    로컬 경로: /mnt/gds/VOD/1.방송중/드라마
    리모트 경로: VOD/1.방송중/드라마
    ```

    로컬 경로에서 /mnt/gds 부분을 삭제해야 하므로
    ```
    /mnt/gds:
    ```

### Plexmate

- **최대 스캔 시간**

    Plexmate의 스캔 항목 중에서 SCANNING 상태가 이 시간을 초과하여 지속될 경우 스캔 실패로 간주합니다. 해당 항목들은 Plexmate Ready 새로고침이 실행될 때 다시 READY로 변경됩니다. 계속해서 SCANNING상태에 빠지는 항목은 수동으로 DB 삭제해 주세요.

- **타임오버 항목 범위**

    Plexmate의 파일 체크 테스트를 통과하지 못해 TIMEOVER된 항목들을 다시 스캔 할 때 사용합니다. Plexmate Ready 새로고침이 실행되면 이 ID 범위내의 TIMEOVER 항목들은 다시 READY로 변경합니다. 계속해서 TIMEOVER가 되는 항목은 점검후 수동으로 DB 삭제해 주세요. 시작 ID 번호와 끝 ID 번호를 ~ 물결표시로 구분해 주세요. 예: 456~501

- **PLEX 경로 변경 규칙**

    Flaskfarm의 로컬 경로와 플렉스의 로컬 경로가 다를 경우 입력해 주세요. Rclone 경로 변경 규칙과 동일한 방식으로 입력해 주면 됩니다.

### 시작 스크립트

Flaskfarm이 시작될 때 실행이 필요한 명령어들을 실행하는 기능을 설정합니다.

- **실행 허용**

    명령어 실행 여부를 설정합니다. 로그에서 어떤 명령어가 실행될 예정인지 확인한 후 실행 여부를 결정하세요.

- **실행할 명령어**

    간단한 쉘 커맨드를 한 줄씩 입력하세요.

- **명령어 최대 대기 시간**

    실행한 명령어 프로세스의 응답 대기 시간입니다.

- **플러그인 의존성 목록**

    플러그인 별로 필요한 타플러그인이나 명령어를 모아 놓은 목록입니다. `../data/db/flaskfarmaider.yaml` 파일을 수정하거나 설정에서 yaml 문법으로 작성해 주세요. 설치된 플러그인의 요구사항들을 이 목록에서 확인 후 시작시 실행합니다.


사용하는 법
---

### 작업을 실행시키는 방법

1. 작업 일정을 만들어서 주기마다 실행
2. 일정 목록의 메뉴 버튼에서 해당 작업을 지금 실행
3. 파일 탐색기의 우클릭 콘텍스트 메뉴로 실행


### 1. 작업 일정을 만들어서 주기마다 실행
- - -

#### **일정 추가 창의 옵션들**

- **작업**: 실행하고자 하는 작업 이름을 선택
- **설명**: 일정 목록에 표시되는 간단한 제목
- **로컬 경로**: 작업의 대상이 되는 로컬 파일 경로 혹은 (작업이 새로고침 후 주기적 스캔일 경우) 주기적 스캔의 ID 번호
- **VFS 리모트**: Rclone 리모트 콘트롤 서버에 요청을 보낼 리모트 이름 (vfs/list로 확인 가능)
- **recursive**: 선택한 작업에 vfs/refresh 과정이 포함되어 있을 경우 --recursive 옵션을 적용
- **일정 방식**
    - **없음**: 일정 목록에만 표시하고 실제로는 실행되지 않음
    - **시작시 실행**: Flaskfarm이 시작되면 한번 실행
    - **시간 간격**: 시간 간격 옵션에 따라 해당 주기마다 실행
    - **시간 간격**: 분 단위 혹은 cron 시간 표현식
- **시작시 일정 등록**: Flaskfarm이 시작되면 자동으로 해당 일정을 활성화

#### **작업 별 일정 추가 방식**


- **새로고침, 새로고침 후 Plexmate 스캔, 새로고침 후 스캔**
```
- 설명: 선택
- 로컬 경로: 필수
- VFS 리모트: 필수 (설정 값이 기본값으로 입력됨)
- recursive: 선택
- 일정 방식: 선택
- 시간 간격: 일정 방식에 따라...
- 시작시 일정 등록: 선택
```

- **스캔, Plexmate 스캔**
```
- 설명: 선택
- 로컬 경로: 필수
- VFS 리모트: 불필요
- recursive: 불필요
- 일정 방식: 선택
- 시간 간격: 일정 방식에 따라...
- 시작시 일정 등록: 선택
```

- **시작 스크립트**
```
- 설명: 선택
- 로컬 경로: 불필요
- VFS 리모트: 불필요
- recursive: 불필요
- 일정 방식: 시작시 실행
- 시간 간격: 불필요
- 시작시 일정 등록: 불필요
```

- **Plexmate Ready 새로고침**
```
- 설명: 선택
- 로컬 경로: 불필요
- VFS 리모트: 필수
- recursive: 선택
- 일정 방식: 선택
- 시간 간격: 일정 방식에 따라...
- 시작시 일정 등록: 선택
```


- **새로고침 후 주기적 스캔**
```
- 설명: 선택
- 로컬 경로: 주기적 스캔의 ID 번호
- VFS 리모트: 필수
- recursive: 선택
- 일정 방식: 선택
- 시간 간격: 일정 방식에 따라...
- 시작시 일정 등록: 선택
```

### 2. 일정 목록의 메뉴 버튼에서 해당 작업을 지금 실행

일정 목록의 우측에 위치한 메뉴 버튼을 클릭한 후 지금 실행 선택

- - -

### 3. 파일 탐색기의 우클릭 콘텍스트 메뉴로 실행

- 하단 간이 파일 탐색기에서 원하는 항목을 우클릭
- 우클릭 콘텍스트 메뉴에서 작업 선택

- - -

### 기타

- 키워드 검색은 설명이 아닌 로컬 경로 옵션을 검색합니다.
- Rclone --vfs-case-insensitive 옵션

    리눅스 계열 파일 시스템은 기본적으로 경로명의 대소문자를 구분합니다. --vfs-case-insensitive 옵션은 이를 보완하는 개념으로 마운트시 대소문자를 구분하지 않게 해 줍니다. 그런데 구드공처럼 vfs/refresh 로 새로고침을 해야 하는 상황에서는 잘못된 폴더를 새로고침하게 될 수도 있습니다.
